<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<%- include('./component/head', { title: '채팅 - 점빵' }) %>
		<link rel="stylesheet" href="/static/chats.min.css" />
</head>

<body>
	<div id="jumbbang">
		<%- include('./component/header') %>
			<main class="container">
				<div class="chatsWrap py-5">
					<form name="chating" class="chating">
						<h3 id="room_name"></h3>
						<div class="users">
							<ul id="userList">

								<li>
									<p id="nick1" class="nick">
										<%= myinfo.nick %>
									</p>
									<% if (myinfo.image) { %>
										<div class="profile1" style="background-image: url('<%= myinfo.image%>')">
										</div>
										<% } else { %>
											<div class="profile1"
												style="background-image: url('https://d1unjqcospf8gs.cloudfront.net/assets/users/default_profile_80-c649f052a34ebc4eee35048815d8e4f73061bf74552558bb70e07133f25524f9.png');">
											</div>
											<% } %>

								</li>
								<li>
									<p id="nick2" class="nick">
										<%= yourinfo.nick %>
									</p>
									<% if (yourinfo.image) { %>
										<div class="profile1" style="background-image: url('<%= yourinfo.image%>')">
										</div>
										<% } else { %>
											<div class="profile1"
												style="background-image: url('https://d1unjqcospf8gs.cloudfront.net/assets/users/default_profile_80-c649f052a34ebc4eee35048815d8e4f73061bf74552558bb70e07133f25524f9.png');">
											</div>
											<% } %>
								</li>
							</ul>
						</div>
						<input type="hidden" value="<%= myinfo.nick %>" id="myrealname">
						<ul id="server-result" class="talkList">
							<!-- <li class="notice"><span>민지님이 입장 하였습니다</span></li>
							<li class="me">
								<span>잘 받았습니다<br /><br /><br /><br />asf</span>
								<p class="date">오후 12:20</p>
							</li>
							<li class="notice"><span>2023-12-20</span></li>
							<li class="other">
								<span class="thumb" style="background-image: url(/static/imgs/profile2.webp)"></span>
								<span>감사합니다~~감사합니다~~감사합니다~~<br /><br /><br /><br />감사합니다~~</span>
								<p class="date">오후 12:21</p>
							</li> -->
							<% if (savedChats.length> 0) { %>
								<% let currentDate=null; %>

									<% for (let i=0; i < savedChats.length; i++) { %>
										<% const chat=savedChats[i]; %>
											<% const chatDate=chat.chatDate; %>

												<% if (currentDate !==chatDate) { %>
													<li class="notice"><span>
															<%= chatDate %>
														</span></li>
													<% currentDate=chatDate; %>
														<% } %>
															<%= console.log(chat) %>
																<% if (savedChats[i].sendId==myinfo.nick) { %>
																	<li class="me">
																		<span>
																			<%= chat.msg %>
																		</span>
																		<p class="date">
																			<%= chat.chatTime %>
																		</p>
																	</li>
																	<% } else { %>
																		<li class="other">
																			<% if (yourinfo.image) { %>
																				<span class="thumb"
																					style="background-image: url('<%= yourinfo.image%>')">
																				</span>
																				<% } else { %>
																					<span class="thumb"
																						style="background-image: url('https://d1unjqcospf8gs.cloudfront.net/assets/users/default_profile_80-c649f052a34ebc4eee35048815d8e4f73061bf74552558bb70e07133f25524f9.png');">
																					</span>
																					<% } %>

																						<%= chat.msg %>
																							</span>
																							<p class="date">
																								<%= chat.chatTime %>
																							</p>
																		</li>
																		<% } %>
																			<% } %>
																				<% } %>


						</ul>
						<div class="inputField">
							<input type="text" id="msg" required placeholder="Message..."
								onkeydown="if(window.event.keyCode == 13){send()}" />
							<button type="button" onclick="send()"></button>
						</div>
						<input type="hidden" id="roomid" value="<%= nowRoomId %>">
						<input type="hidden" id="roomname" value="<%= roomname%>">
					</form>
					<div class="mt-5">
						<a onclick="exit('<%= nowRoomId %>', '<%= from%>')"
							class="btn-primary w-100 d-block text-center">채팅
							나가기</a>
					</div>
				</div>
			</main>
			<%- include('./component/footer') %>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.11.0/qs.min.js"
		integrity="sha512-/l6vieC+YxaZywUhmqs++8uF9DeMvJE61ua5g+UK0TuHZ4TkTgB1Gm1n0NiA86uEOM9JJ6JUwyR0hboKO0fCng=="
		crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
	<script src="../static/js/chats.js"></script>
</body>

</html>